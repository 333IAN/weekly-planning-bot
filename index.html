<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Control v2</title>
    <style>
        /* --- CSS --- */
        :root { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --accent: #38bdf8; --danger: #ef4444; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; min-height: 100vh; margin: 0; }
        .container { width: 90%; max-width: 800px; margin-top: 50px; }
        h1 { text-align: center; font-weight: 300; margin-bottom: 30px; }
        
        .input-group {
            display: flex; gap: 10px; background: var(--card); padding: 15px;
            border-radius: 10px; flex-wrap: wrap;
        }
        
        input[type="text"] { flex: 2; background: transparent; border: 1px solid #334155; color: white; padding: 10px; border-radius: 5px; }
        
        /* Input Styling */
        input[type="datetime-local"] { flex: 1; background: #334155; border: none; color: white; padding: 10px; border-radius: 5px; color-scheme: dark; }

        button#add-btn { background: var(--accent); border: none; padding: 10px 25px; border-radius: 5px; color: #0f172a; font-weight: bold; cursor: pointer; }
        button#add-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        ul { list-style: none; padding: 0; margin-top: 20px; }
        li { background: var(--card); margin-bottom: 10px; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .status { font-size: 0.8rem; color: #94a3b8; margin-left: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Mission Control</h1>

    <div class="input-group">
        <input type="text" id="task-input" placeholder="Task Name">
        <input type="datetime-local" id="time-input">
        <button id="add-btn">Sync to Cal</button>
    </div>

    <ul id="task-list"></ul>
</div>

<script>
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwUtECPRyfAp3vbXQmFmiaQ0AquU0sFYg91JLtRZzIMZaexFRzGYq3DCd1wdAa2QrPE/exec"; 
    // ---------------------

    const taskInput = document.getElementById('task-input');
    const timeInput = document.getElementById('time-input');
    const addBtn = document.getElementById('add-btn');
    const taskList = document.getElementById('task-list');

    addBtn.addEventListener('click', addTask);

    function addTask() {
        const taskText = taskInput.value;
        const taskTime = timeInput.value;

        if (taskText === '' || taskTime === '') {
            alert("Please enter both a task and a time.");
            return;
        }

        // 1. Show visually immediately (Optimistic UI)
        createTaskElement(taskText, "Syncing...");
        addBtn.disabled = true; // Prevent double clicks
        addBtn.innerText = "Sending...";

        // 2. Send to Google Backend
        fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            mode: "no-cors", // Essential for Google Apps Script
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ task: taskText, time: taskTime })
        })
        .then(() => {
            // Because of 'no-cors', we can't read the response, 
            // but if we get here, the request was sent successfully.
            updateLastTaskStatus("Synced ✅");
            addBtn.disabled = false;
            addBtn.innerText = "Sync to Cal";
            
            // Clear inputs
            taskInput.value = '';
            timeInput.value = '';
        })
        .catch(error => {
            console.error(error);
            updateLastTaskStatus("Error ❌");
            addBtn.disabled = false;
            addBtn.innerText = "Sync to Cal";
        });
    }

    function createTaskElement(text, status) {
        const li = document.createElement('li');
        li.innerHTML = `<span>${text} <span class="status">${status}</span></span>`;
        taskList.prepend(li);
    }

    function updateLastTaskStatus(newStatus) {
        const firstItem = taskList.firstElementChild;
        if (firstItem) {
            const statusSpan = firstItem.querySelector('.status');
            statusSpan.innerText = newStatus;
        }
    }
</script>

</body>
</html>